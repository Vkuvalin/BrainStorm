package com.kuvalin.brainstorm.globalClasses

import android.util.Log
import kotlinx.coroutines.delay



//region –ü—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞–±–æ—Ç—ã —Å –∫–ª–∞—Å—Å–æ–º UniversalDecorator
/*

1. –û—Å–º—ã—Å–ª–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä —É—Ä–æ–≤–Ω—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:
–ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ UniversalDecorator –≤–∞–∂–Ω–æ –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ –≤—ã–±–∏—Ä–∞—Ç—å —É—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è (DEBUG, INFO, WARN).
–£—Ä–æ–≤–µ–Ω—å DEBUG —Å–ª–µ–¥—É–µ—Ç –ø—Ä–∏–º–µ–Ω—è—Ç—å –¥–ª—è –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –æ—Ç–ª–∞–¥–∫–∏, INFO ‚Äî –¥–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π, –∞ WARN ‚Äî –¥–ª—è —Ñ–∏–∫—Å–∞—Ü–∏–∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π.
üö® –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –ò–∑–±–µ–≥–∞–π—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è DEBUG –¥–ª—è —Ä—É—Ç–∏–Ω–Ω—ã—Ö –∑–∞–¥–∞—á, —á—Ç–æ–±—ã –Ω–µ –∑–∞—Å–æ—Ä—è—Ç—å –ª–æ–≥–∏ –∏–∑–ª–∏—à–Ω–µ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π.

2. –ö–æ–Ω—Ç—Ä–æ–ª—å –∑–∞ –æ–±—ä–µ–º–æ–º –ª–æ–≥–æ–≤:
–£—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è DEBUG –∏ WARN –º–æ–≥—É—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –±–æ–ª—å—à–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.
–í–∞–∂–Ω–æ —Å–ª–µ–¥–∏—Ç—å –∑–∞ —Ç–µ–º, —á—Ç–æ–±—ã —ç—Ç–∏ –ª–æ–≥–∏ –Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∂–∞–ª–∏ Logcat, –æ—Å–æ–±–µ–Ω–Ω–æ –≤ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω–æ–π —Å—Ä–µ–¥–µ.
üìä –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∞–π—Ç–µ DEBUG –∏–ª–∏ —Ñ–∏–ª—å—Ç—Ä—É–π—Ç–µ –µ–≥–æ, —á—Ç–æ–±—ã —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á–∏—Ç—å—Å—è –Ω–∞ –≤–∞–∂–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.

3. –ú–∏–Ω–∏–º–∞–ª–∏–∑–º –∏ —Ñ–æ–∫—É—Å –Ω–∞ —Ü–µ–ª—è—Ö:
–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–º –∏ —Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ –≤–∞–∂–Ω—ã—Ö —Å–æ–±—ã—Ç–∏—è—Ö –∏ –¥–µ–π—Å—Ç–≤–∏—è—Ö.
–ö–∞–∂–¥—ã–π –ª–æ–≥ –¥–æ–ª–∂–µ–Ω –ø—Ä–∏–Ω–æ—Å–∏—Ç—å —Ü–µ–Ω–Ω–æ—Å—Ç—å, –±—É–¥—å —Ç–æ –æ—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, —Å—Ç–∞—Ç—É—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏–ª–∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ.
‚úÇÔ∏è –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –°—Ç–∞—Ä–∞–π—Ç–µ—Å—å –∏–∑–±–µ–≥–∞—Ç—å –∏–∑–±—ã—Ç–æ—á–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è.
–ï—Å–ª–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–µ –ø—Ä–∏–Ω–æ—Å–∏—Ç –ø–æ–ª—å–∑—ã –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ, –µ—ë –ª—É—á—à–µ –∏—Å–∫–ª—é—á–∏—Ç—å.

4. –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —É—Ä–æ–≤–Ω–µ–π –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç—É:
–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —É—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–¥–∞.
–ï—Å–ª–∏ –¥–µ–π—Å—Ç–≤–∏–µ –∫—Ä–∏—Ç–∏—á–Ω–æ –∏–ª–∏ –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã, –ø—Ä–∏–º–µ–Ω—è–π—Ç–µ WARN.
–î–ª—è –æ–±—â–µ–≥–æ —Å—Ç–∞—Ç—É—Å–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏–ª–∏ —É—Å–ø–µ—Ö–∞ –¥–µ–π—Å—Ç–≤–∏—è –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ INFO.
üîç –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –û—Ü–µ–Ω–∏—Ç–µ –≤–∞–∂–Ω–æ—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏—è –ø–µ—Ä–µ–¥ —Ç–µ–º, –∫–∞–∫ –≤—ã–±—Ä–∞—Ç—å —É—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è, —á—Ç–æ–±—ã –ª–æ–≥ –±—ã–ª —Ç–æ—á–Ω—ã–º –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º.

5. –ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Å—Ä–µ–¥—ã:
–í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å—Ä–µ–¥—ã (—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, –ø—Ä–æ–¥–∞–∫—à–µ–Ω) –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è.
–ù–∞–ø—Ä–∏–º–µ—Ä, –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –ª—É—á—à–µ –º–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ DEBUG –∏ WARN.
‚öôÔ∏è –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∞–∫, —á—Ç–æ–±—ã –æ–Ω–æ –ø–æ–¥—Ö–æ–¥–∏–ª–æ –ø–æ–¥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é —Å—Ä–µ–¥—É, –∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è–º–∏ –ª–æ–≥–æ–≤.

6. –û—Ü–µ–Ω–∫–∞ –ø–æ–ª–µ–∑–Ω–æ—Å—Ç–∏ –ª–æ–≥–æ–≤:
–ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Å–º–∞—Ç—Ä–∏–≤–∞–π—Ç–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –æ–Ω–æ –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É –ø—Ä–∏–Ω–æ—Å–∏—Ç —Ü–µ–Ω–Ω–æ—Å—Ç—å –∏ –Ω–µ —Å—Ç–∞–ª–æ –∏–∑–±—ã—Ç–æ—á–Ω—ã–º.
üìà –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –ê–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –ª–æ–≥–∏ –∏, –µ—Å–ª–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ –∏–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏—è —Å—Ç–∞–ª–∏ –Ω–µ–∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏,
—É–±–∏—Ä–∞–π—Ç–µ –∏—Ö –∏–∑ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞ –∏–ª–∏ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç–µ –Ω–∞ –±–æ–ª–µ–µ –Ω–∏–∑–∫–∏–π —É—Ä–æ–≤–µ–Ω—å.
–≠—Ç–∏ –ø—Ä–∏–Ω—Ü–∏–ø—ã –ø–æ–º–æ–≥—É—Ç –æ–±–µ—Å–ø–µ—á–∏—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∏ —Ü–µ–ª–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ UniversalDecorator,
–º–∏–Ω–∏–º–∏–∑–∏—Ä—É—è —Ä–∏—Å–∫–∏ –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ –ª–æ–≥–æ–≤ –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—è –≤—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –æ—Ç–ª–∞–¥–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
*/
//endregion


/**
 * –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π –ø–µ—Ä–µ–¥ –∏ –ø–æ—Å–ª–µ –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏.
 *
 * @param baseLogTag –ë–∞–∑–æ–≤—ã–π –ª–æ–≥-—Ç–µ–≥ –¥–ª—è –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏–π.
 * @param measureMainFunctionTime –ó–∞–º–µ—Ä –≤—Ä–µ–º–µ–Ω–∏ –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏.
 * @param measureAllActionsTime –ó–∞–º–µ—Ä –≤—Ä–µ–º–µ–Ω–∏ –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π (–≤–∫–ª—é—á–∞—è before –∏ after).
 *
 * @see [com.kuvalin.brainstorm.globalClasses.DecAction]
 */
class UniversalDecorator(
    private val baseLogTag: String = "DecLog",
    private val measureMainFunctionTime: Boolean = false,
    private val measureAllActionsTime: Boolean = false
) {

    /**
     * –£—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è.
     */
    enum class LogLevel {
        DEBUG, INFO, WARN
    }


    fun logOutput(
        action: DecAction.Log,
        subLogTag: String? = null
    ){
        val fullLogTag = buildString {
            append(baseLogTag)
            subLogTag?.let { append("-$it") }
        }
        logMessage(fullLogTag, action.message, action.logLevel)
    }


    /**
     * –ú–µ—Ç–æ–¥ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π –ø–µ—Ä–µ–¥ –∏ –ø–æ—Å–ª–µ –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏.
     *
     * @param mainFunc –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä—É—é –Ω—É–∂–Ω–æ –æ–±–µ—Ä–Ω—É—Ç—å. –û–Ω–∞ –º–æ–∂–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –ª—é–±–æ–≥–æ —Ç–∏–ø–∞ T.
     * @param beforeActions –°–ø–∏—Å–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω—ã –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏.
     * @param afterActions –°–ø–∏—Å–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω—ã –ø–æ—Å–ª–µ –≤—ã–∑–æ–≤–∞ –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏.
     * @param logLevel –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (DEBUG, INFO, WARN).
     * @param subLogTag –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –ª–æ–≥-—Ç–µ–≥, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –∫ –±–∞–∑–æ–≤–æ–º—É.
     * @return –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏.
     */
    //region fun <T> execute
    fun <T> execute(
        mainFunc: () -> T,
        beforeActions: List<DecAction>? = null,
        afterActions: List<DecAction>? = null,
        subLogTag: String? = null
    ): T {
        val fullLogTag = buildString {
            append(baseLogTag)
            subLogTag?.let { append("-$it") }
        }

        // –ó–∞–º–µ—Ä –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π, –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω
        val totalStartTime = if (measureAllActionsTime) System.currentTimeMillis() else 0L

        // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π –¥–æ –≤—ã–∑–æ–≤–∞ –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
        beforeActions?.forEach { action ->
            executeSyncAction(action, fullLogTag)
        }

        // –ó–∞–º–µ—Ä –≤—Ä–µ–º–µ–Ω–∏ –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
        val startTime = if (measureMainFunctionTime) System.currentTimeMillis() else 0L

        // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
        val result = mainFunc()

        // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
        if (measureMainFunctionTime) {
            val endTime = System.currentTimeMillis()
            logMessage(fullLogTag, "Main function execution time: ${endTime - startTime} ms", LogLevel.INFO)
        }

        // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π –ø–æ—Å–ª–µ –≤—ã–∑–æ–≤–∞ –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
        afterActions?.forEach { action ->
            executeSyncAction(action, fullLogTag)
        }

        // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π
        if (measureAllActionsTime) {
            val totalEndTime = System.currentTimeMillis()
            logMessage(fullLogTag, "Total execution time (all actions): ${totalEndTime - totalStartTime} ms", LogLevel.INFO)
        }

        return result
    }
    //endregion


    /**
     * –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π –ø–µ—Ä–µ–¥ –∏ –ø–æ—Å–ª–µ –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏.
     *
     * @param mainFunc –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä—É—é –Ω—É–∂–Ω–æ –æ–±–µ—Ä–Ω—É—Ç—å. –û–Ω–∞ –º–æ–∂–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –ª—é–±–æ–≥–æ —Ç–∏–ø–∞ T.
     * @param beforeActions –°–ø–∏—Å–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω—ã –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏.
     * @param afterActions –°–ø–∏—Å–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω—ã –ø–æ—Å–ª–µ –≤—ã–∑–æ–≤–∞ –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏.
     * @param logLevel –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (DEBUG, INFO, WARN).
     * @param subLogTag –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –ª–æ–≥-—Ç–µ–≥, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –∫ –±–∞–∑–æ–≤–æ–º—É.
     * @return –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏.
     */
    //region suspend fun <T> executeAsync
    suspend fun <T> executeAsync(
        mainFunc: suspend () -> T,
        beforeActions: List<DecAction>? = null,
        afterActions: List<DecAction>? = null,
        subLogTag: String? = null
    ): T {
        val fullLogTag = buildString {
            append(baseLogTag)
            subLogTag?.let { append("-$it") }
        }

        // –ó–∞–º–µ—Ä –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π, –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω
        val totalStartTime = if (measureAllActionsTime) System.currentTimeMillis() else 0L

        // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π –¥–æ –≤—ã–∑–æ–≤–∞ –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
        beforeActions?.forEach { action ->
            executeAsyncAction(action, fullLogTag)
        }

        // –ó–∞–º–µ—Ä –≤—Ä–µ–º–µ–Ω–∏ –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
        val startTime = if (measureMainFunctionTime) System.currentTimeMillis() else 0L

        // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
        val result = mainFunc()

        // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
        if (measureMainFunctionTime) {
            val endTime = System.currentTimeMillis()
            logMessage(fullLogTag, "Main function execution time: ${endTime - startTime} ms", LogLevel.INFO)
        }

        // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π –ø–æ—Å–ª–µ –≤—ã–∑–æ–≤–∞ –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
        afterActions?.forEach { action ->
            executeAsyncAction(action, fullLogTag)
        }

        // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π
        if (measureAllActionsTime) {
            val totalEndTime = System.currentTimeMillis()
            logMessage(fullLogTag, "Total execution time (all actions): ${totalEndTime - totalStartTime} ms", LogLevel.INFO)
        }

        return result
    }
    //endregion


    /**
     * –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π –≤ Logcat.
     *
     * @param logTag –¢–µ–≥ –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è.
     * @param message –°–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è.
     * @param logLevel –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (DEBUG, INFO, WARN).
     */
    private fun logMessage(logTag: String, message: String, logLevel: LogLevel) {
        when (logLevel) {
            LogLevel.DEBUG -> Log.d(logTag, message)
            LogLevel.INFO -> Log.i(logTag, message)
            LogLevel.WARN -> Log.w(logTag, message)
        }
    }


    /**
     * –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏—è (—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è).
     *
     * @param action –î–µ–π—Å—Ç–≤–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å.
     * @param logTag –¢–µ–≥ –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è.
     * @param logLevel –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è.
     */
    private fun executeSyncAction(action: DecAction, logTag: String) {
        when (action) {
            is DecAction.Log -> logMessage(logTag, action.message, action.logLevel)
            is DecAction.Execute -> action.function(logTag)
            is DecAction.MeasureTime -> Unit // –ó–∞–º–µ—Ä –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –∫–æ–¥–µ
            is DecAction.Delay -> {} // Delay –∑–¥–µ—Å—å –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è
        }
    }


    /**
     * –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏—è (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è).
     *
     * @param action –î–µ–π—Å—Ç–≤–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å.
     * @param logTag –¢–µ–≥ –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è.
     * @param logLevel –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è.
     */
    private suspend fun executeAsyncAction(action: DecAction, logTag: String) {
        when (action) {
            is DecAction.Log -> logMessage(logTag, action.message, action.logLevel)
            is DecAction.Execute -> action.function(logTag)
            is DecAction.MeasureTime -> Unit // –ó–∞–º–µ—Ä –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –∫–æ–¥–µ
            is DecAction.Delay -> delay(action.millis)
        }
    }

}

/**
 * Sealed class, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—â–∏–π –≤–æ–∑–º–æ–∂–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –¥–ª—è –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞.
 */
sealed class DecAction {
    /**
     * –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è.
     *
     * @param message –°–æ–æ–±—â–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –Ω—É–∂–Ω–æ –∑–∞–ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å.
     * @param logLevel –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (DEBUG, INFO, WARN).
     */
    class Log(
        val message: String,
        val logLevel: UniversalDecorator.LogLevel = UniversalDecorator.LogLevel.INFO
    ) : DecAction()


    /**
     * –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏.
     *
     * @param function –§—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä—É—é –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å.
     */
    class Execute(val function: (String) -> Unit) : DecAction()


    /**
     * –ó–∞–º–µ—Ä –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏.
     */
    object MeasureTime : DecAction()


    /**
     * –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º.
     *
     * @param millis –ó–∞–¥–µ—Ä–∂–∫–∞ –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö.
     */
    class Delay(val millis: Long) : DecAction()
}
